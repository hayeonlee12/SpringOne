<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>회원 가입</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h1>회원 가입</h1>
    <form action="/members/register" method="post" th:object="${memberForm}">
        <div>
            <label for="userid">아이디:</label>
            <input type="text" id="userid" name="userid" th:field="*{userid}"><br/>
            <button type="button" id="overlappedID">중복확인</button>
            <span id="olmessage"></span>
            <span class="error" th:if="${#fields.hasErrors('userid')}" th:errors="*{userid}" ></span>
        </div>
        <div>
            <label for="username">이름:</label>
            <input type="text" id="username" name="username" th:field="*{username}" ><br/>
            <span class="error" th:if="${#fields.hasErrors('username')}" th:errors="*{username}" ></span>
        </div>
        <div>
            <label for="userpw">비밀번호:</label>
            <input type="password" id="userpw" name="userpw" th:field="*{userpw}" ><br/>
            <span class="error" th:if="${#fields.hasErrors('userpw')}" th:errors="*{userpw}" ></span>
        </div>
        <div>
            <label for="useremail">이메일:</label>
            <input type="email" id="useremail" name="useremail" th:field="*{useremail}" ><br/>
            <span class="error" th:if="${#fields.hasErrors('useremail')}" th:errors="*{useremail}" ></span>
        </div>
        <div>
            <label for="userphone">휴대폰번호:</label>
            <input type="text" id="userphone" name="userphone" th:field="*{userphone}" ><br/>
            <span class="error" th:if="${#fields.hasErrors('userphone')}" th:errors="*{userphone}" ></span>
        </div>
        <div>
            <input type="submit" id="signup" value="가입하기">
        </div>
    </form>
    
    <script>
    $("#overlappedID").click(function(){
        const id = $("#userid").val();
        $.ajax({
            type: "GET",
            url: "/members/idcheck", // 컨트롤러 향하는 링크 작성 시 localhost부터 하면 오류 발생 있을 수 있음. /members/idcheck로 수정
            data: {userid: id}, // 전달값이 우측 (userid)
            success: function(data) {
                if (data === 1) { // == 은 무한재귀 발생 가능, 중복된 아이디 발견시 계속 ajax요청 함으로 ===로 수정.
                    alert("중복된 아이디입니다.");
                    $("#olmessage").text("이미 사용중인 ID입니다.");
                    $("#olmessage").addClass("olmessagef");
                    $("#olmessage").removeClass("olmessaget");
                } else {
                    $("#olmessage").text("사용 가능한 ID입니다.");
                    $("#olmessage").addClass("olmessaget");
                    $("#olmessage").removeClass("olmessagef");
                    $("#signup").attr("type", "submit");
                }
            },
            error: function(xhr, textStatus, errorThrown) {
                console.log("Error:", errorThrown);
            }
        });
    });
    
    </script>

</body>
</html>